{"ast":null,"code":"/*\n * Copyright 2012-2016 the original author or authors\n * @license MIT, see LICENSE.txt for details\n *\n * @author Scott Andrews\n */\n'use strict';\n\nvar mime, registry;\nmime = require('../mime');\n\nfunction Registry(mimes) {\n  /**\n   * Lookup the converter for a MIME type\n   *\n   * @param {string} type the MIME type\n   * @return a promise for the converter\n   */\n  this.lookup = function lookup(type) {\n    var parsed;\n    parsed = typeof type === 'string' ? mime.parse(type) : type;\n\n    if (mimes[parsed.raw]) {\n      return mimes[parsed.raw];\n    }\n\n    if (mimes[parsed.type + parsed.suffix]) {\n      return mimes[parsed.type + parsed.suffix];\n    }\n\n    if (mimes[parsed.type]) {\n      return mimes[parsed.type];\n    }\n\n    if (mimes[parsed.suffix]) {\n      return mimes[parsed.suffix];\n    }\n\n    return Promise.reject(new Error('Unable to locate converter for mime \"' + parsed.raw + '\"'));\n  };\n  /**\n   * Create a late dispatched proxy to the target converter.\n   *\n   * Common when a converter is registered under multiple names and\n   * should be kept in sync if updated.\n   *\n   * @param {string} type mime converter to dispatch to\n   * @returns converter whose read/write methods target the desired mime converter\n   */\n\n\n  this.delegate = function delegate(type) {\n    return {\n      read: function () {\n        var args = arguments;\n        return this.lookup(type).then(function (converter) {\n          return converter.read.apply(this, args);\n        }.bind(this));\n      }.bind(this),\n      write: function () {\n        var args = arguments;\n        return this.lookup(type).then(function (converter) {\n          return converter.write.apply(this, args);\n        }.bind(this));\n      }.bind(this)\n    };\n  };\n  /**\n   * Register a custom converter for a MIME type\n   *\n   * @param {string} type the MIME type\n   * @param converter the converter for the MIME type\n   * @return a promise for the converter\n   */\n\n\n  this.register = function register(type, converter) {\n    mimes[type] = Promise.resolve(converter);\n    return mimes[type];\n  };\n  /**\n   * Create a child registry whoes registered converters remain local, while\n   * able to lookup converters from its parent.\n   *\n   * @returns child MIME registry\n   */\n\n\n  this.child = function child() {\n    return new Registry(Object.create(mimes));\n  };\n}\n\nregistry = new Registry({}); // include provided serializers\n\nregistry.register('application/hal', require('./type/application/hal'));\nregistry.register('application/json', require('./type/application/json'));\nregistry.register('application/x-www-form-urlencoded', require('./type/application/x-www-form-urlencoded'));\nregistry.register('multipart/form-data', require('./type/multipart/form-data'));\nregistry.register('text/plain', require('./type/text/plain'));\nregistry.register('+json', registry.delegate('application/json'));\nmodule.exports = registry;","map":null,"metadata":{},"sourceType":"script"}
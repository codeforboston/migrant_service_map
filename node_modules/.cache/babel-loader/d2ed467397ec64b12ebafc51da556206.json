{"ast":null,"code":"/*\n * Copyright 2014-2016 the original author or authors\n * @license MIT, see LICENSE.txt for details\n *\n * @author Scott Andrews\n */\n'use strict';\n/*jshint latedef: nofunc */\n\nvar normalizeHeaderName = require('./normalizeHeaderName');\n\nfunction property(promise, name) {\n  return promise.then(function (value) {\n    return value && value[name];\n  }, function (value) {\n    return Promise.reject(value && value[name]);\n  });\n}\n/**\n * Obtain the response entity\n *\n * @returns {Promise} for the response entity\n */\n\n\nfunction entity() {\n  /*jshint validthis:true */\n  return property(this, 'entity');\n}\n/**\n * Obtain the response status\n *\n * @returns {Promise} for the response status\n */\n\n\nfunction status() {\n  /*jshint validthis:true */\n  return property(property(this, 'status'), 'code');\n}\n/**\n * Obtain the response headers map\n *\n * @returns {Promise} for the response headers map\n */\n\n\nfunction headers() {\n  /*jshint validthis:true */\n  return property(this, 'headers');\n}\n/**\n * Obtain a specific response header\n *\n * @param {String} headerName the header to retrieve\n * @returns {Promise} for the response header's value\n */\n\n\nfunction header(headerName) {\n  /*jshint validthis:true */\n  headerName = normalizeHeaderName(headerName);\n  return property(this.headers(), headerName);\n}\n/**\n * Follow a related resource\n *\n * The relationship to follow may be define as a plain string, an object\n * with the rel and params, or an array containing one or more entries\n * with the previous forms.\n *\n * Examples:\n *   response.follow('next')\n *\n *   response.follow({ rel: 'next', params: { pageSize: 100 } })\n *\n *   response.follow([\n *       { rel: 'items', params: { projection: 'noImages' } },\n *       'search',\n *       { rel: 'findByGalleryIsNull', params: { projection: 'noImages' } },\n *       'items'\n *   ])\n *\n * @param {String|Object|Array} rels one, or more, relationships to follow\n * @returns ResponsePromise<Response> related resource\n */\n\n\nfunction follow(rels) {\n  /*jshint validthis:true */\n  rels = [].concat(rels);\n  return make(rels.reduce(function (response, rel) {\n    return response.then(function (response) {\n      if (typeof rel === 'string') {\n        rel = {\n          rel: rel\n        };\n      }\n\n      if (typeof response.entity.clientFor !== 'function') {\n        throw new Error('Hypermedia response expected');\n      }\n\n      var client = response.entity.clientFor(rel.rel);\n      return client({\n        params: rel.params\n      });\n    });\n  }, this));\n}\n/**\n * Wrap a Promise as an ResponsePromise\n *\n * @param {Promise<Response>} promise the promise for an HTTP Response\n * @returns {ResponsePromise<Response>} wrapped promise for Response with additional helper methods\n */\n\n\nfunction make(promise) {\n  promise.status = status;\n  promise.headers = headers;\n  promise.header = header;\n  promise.entity = entity;\n  promise.follow = follow;\n  return promise;\n}\n\nfunction responsePromise(obj, callback, errback) {\n  return make(Promise.resolve(obj).then(callback, errback));\n}\n\nresponsePromise.make = make;\n\nresponsePromise.reject = function (val) {\n  return make(Promise.reject(val));\n};\n\nresponsePromise.promise = function (func) {\n  return make(new Promise(func));\n};\n\nmodule.exports = responsePromise;","map":null,"metadata":{},"sourceType":"script"}